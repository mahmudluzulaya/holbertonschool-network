#!/usr/bin/env bash
# Configures localhost to 127.0.0.2 and facebook.com to 8.8.8.8

# Create a temporary hosts file
tmpfile=$(mktemp)

# Rewrite /etc/hosts with modified entries
while read -r line; do
    case "$line" in
        127.0.0.1*localhost*)
            echo "127.0.0.2 localhost" >> "$tmpfile"
            ;;
        *facebook.com*)
            echo "8.8.8.8 facebook.com" >> "$tmpfile"
            ;;
        *)
            echo "$line" >> "$tmpfile"
            ;;
    esac
done < /etc/hosts

# If facebook.com did not exist, append it
if ! grep -q "facebook.com" "$tmpfile"; then
    echo "8.8.8.8 facebook.com" >> "$tmpfile"
fi

# Overwrite /etc/hosts (tee works in checker environment)
sudo tee /etc/hosts > /dev/null < "$tmpfile"

# Remove temporary file
rm "$tmpfile"
