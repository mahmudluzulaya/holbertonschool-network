#!/usr/bin/env bash
# Configures localhost to 127.0.0.2 and facebook.com to 8.8.8.8

tmpfile=$(mktemp)

# Rewrite hosts file into temporary file
while IFS= read -r line; do
    case "$line" in
        127.0.0.1*localhost*)
            echo "127.0.0.2 localhost" >> "$tmpfile"
            ;;
        *facebook.com*)
            echo "8.8.8.8 facebook.com" >> "$tmpfile"
            ;;
        *)
            echo "$line" >> "$tmpfile"
            ;;
    esac
done < /etc/hosts

# Ensure facebook.com entry exists
if ! grep -q "facebook.com" "$tmpfile"; then
    echo "8.8.8.8 facebook.com" >> "$tmpfile"
fi

# Overwrite /etc/hosts (ShellCheck-correct method)
sudo sh -c "cat '$tmpfile' > /etc/hosts"

# Clean up
rm "$tmpfile"
